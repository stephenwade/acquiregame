<link rel="import" href="../paper-header-panel/paper-header-panel.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<link rel="import" href="../polymer/polymer.html">

<dom-module id="acquire-newgame-page">

  <template>
    <style>
      paper-button {
        display: block;
        max-width: 12em;
        margin: 1em auto;
        color: white;
        background-color: #1c66e3;
      }
      paper-button[disabled] {
        background-color: #aaa;
        color: black;
      }
      paper-icon-button {
        margin-left: -12px;
        margin-right: 8px;
        color: white;
      }
      
      #game-ID {
        font-weight: bold;
      }
    </style>
    
    <paper-header-panel mode="waterfall">
      <paper-toolbar id="header">
        <a href="#home" tabindex="-1"><paper-icon-button icon="arrow-back"></paper-icon-button></a>
        <h3 class="flex">New game</h3>
      </paper-toolbar>
      <main>
        <p>Players can connect to this game using ID <span id="game-ID"></span>.</p>
        <p>Waiting for players to connectâ€¦</p>
        <p>Players:</p>
        <div id="players"></div>
        <paper-button on-click="startGame" disabled>Start game</paper-button>
      </main>
    </paper-header-panel>
  </template>
  
  <script>
    'use strict';
    
    Polymer({
      is: 'acquire-newgame-page',
      
      attached: function() {
        socket.emit('new game');
        
        socket.on('game created', function(msg) {
          Acquire.gameID = msg;
          $('#game-ID').html(Acquire.gameID);
        });
        
        socket.on('setup state', function(msg) {
          $('#players').html(msg.players.map((player) => player.nickname).toString());
          $('paper-button').attr('disabled', ! msg.isReady);
        });
      },
      
      startGame: function() {
        window.location.hash = '#board/' + Acquire.gameID;
      }
    });
  </script>

</dom-module>
